#!/usr/bin/env ruby

# Get the repo name
print "What is the respository name: "
sitename = gets.chomp

# Do we want to copy the database
print "Create database from stage? [n] "
copy_db = gets.chomp.downcase == 'y' ? true : false

repo_url = "git@bitbucket.org:greeneking/#{sitename}.git"

puts "Checking out #{repo_url}"
puts `mkdir -p #{sitename}/logs`
puts `cd #{sitename} && git clone #{repo_url} webroot`

if copy_db
	puts 'Creating database...', `mysql -u root -e 'create database if not exists #{sitename}_local_develop'`
	puts 'Exporting stage database...', `drush @#{sitename}.stage.develop mysql-dump > #{sitename}_local_develop.sql`
	puts 'Importing database to local...', `mysql #{sitename} < #{sitename}_local_develop.sql`
	puts 'Removing sql file...', `rm #{sitename}_local_develop.sql`
end

puts 'Running sync...', `drush-site-sync @#{sitename}.stage.develop @#{sitename}.local.develop`

# cd /srv/build

# mkdir -p ipa/logs
# mkdir -p ipa/webroot
# cd ipa/webroot
# git clone git@bitbucket.org:greeneking/ipa.git .
# drush make ipa.make --working-copy
# drush @ipa.stage.develop mysql-dump > ipa-stage-develop.sql
