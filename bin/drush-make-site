#!/usr/bin/env ruby

# Show a warning if we're not in /srv directory
if !Dir.pwd.start_with?('/srv')
	puts "This command should be run from /srv/build or similar"
	puts "-----------------------------------------------------"
end

# Get the sites name
print "Site to clone: "
sitename = gets.chomp

# Get the branch (default to develop)
print "Branch (develop): "
branch = gets.chomp
branch = 'develop' if branch.empty?

# Get the branch (default to develop)
print "Make the site? (Y/n): "
make = gets.chomp.downcase == 'y' ? true : false

# Set up git url
git_url = "git@bitbucket.org:greeneking/#{sitename}.git"

# Clone site
system "mkdir -p #{sitename}/#{branch}/logs"
Dir.chdir Dir.pwd + "/#{sitename}/#{branch}"
system "git clone #{git_url} webroot"


# Make site
if make
	Dir.chdir Dir.pwd + "/webroot"
	system "drush make #{sitename}.make --working-copy"
end
