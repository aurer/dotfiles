if [ -f /etc/bash_completion ]; then
    source /etc/bash_completion
fi

if tput setaf 1 &> /dev/null; then
    tput sgr0; # reset colors
    bold=$(tput bold);
    reset=$(tput sgr0);
    black=$(tput setaf 0);
    blue=$(tput setaf 33);
    cyan=$(tput setaf 37);
    green=$(tput setaf 64);
    orange=$(tput setaf 166);
    purple=$(tput setaf 125);
    red=$(tput setaf 124);
    violet=$(tput setaf 61);
    white=$(tput setaf 15);
    yellow=$(tput setaf 136);
else
    bold='';
    reset="\e[0m";
    black="\e[1;30m";
    blue="\e[1;34m";
    cyan="\e[1;36m";
    green="\e[1;32m";
    orange="\e[1;33m";
    purple="\e[1;35m";
    red="\e[1;31m";
    violet="\e[1;35m";
    white="\e[1;37m";
    yellow="\e[1;33m";
fi;

__has_parent_dir () {
    # Utility function so we can test for things like .git/.hg without firing up a
    # separate process
    test -d "$1" && return 0;

    current="."
    while [ ! "$current" -ef "$current/.." ]; do
        if [ -d "$current/$1" ]; then
            return 0;
        fi
        current="$current/..";
    done

    return 1;
}

__vcs_name() {
    if [ -d .svn ]; then
        echo "[svn]";
    elif __has_parent_dir ".git"; then
        echo "[$(__git_ps1 'git %s')]";
    elif __has_parent_dir ".hg"; then
        echo "[hg $(hg branch)]"
    fi
}

__git_changes() {
    if  __has_parent_dir ".git"; then
        echo "$(git status -s | wc -l | tr -d ' ')";
    fi
}

userstyle=$cyan
if [ "$EUID" == "0" ]; then
  userstyle=$red;
fi

# Nicely formatted terminal prompt
export PS1='\n\[$bold\]\[$black\]\[$userstyle\]\u - \[$userstyle\]\h \[$yellow\]\w \[$orange\]$(__vcs_name):$(__git_changes)\[$black\]\[$reset\]\n\[$userstyle\]âžœ\[$reset\] '