#!/usr/bin/env ruby

# Help text
help = <<EOS
Usage: grokr <site> [options]

Example: grokr localhost:3000
This will create a tunnel to localhost:3000 at the address localhost.gk.ngrok.com

Options: -d Debug mode - opens ngroks debug window in a browser
EOS

# Get url from arguments
url = ""
ARGV.each do |arg|
	if !arg.match /^-/ then
		url = arg
	end
end

# Work out a simpler url
simpleurl = url.gsub /:[\d]+/, ''
simpleurl.gsub! '.local', ''

# Create the basic command
command = "ngrok -authtoken 8mCsU3iRBbVxNXyes3y4 -subdomain #{simpleurl}.gk #{url}"

# Get other arguments
ARGV.each do |arg|
	case arg
	when "--help", "-h"
		puts help
		exit
	when "-d"
		command = "sleep 1 && xdg-open 'http://localhost:4040' && #{command}"
	end
end

# If no url as given exit with help
if url.length == 0 then
	puts help
	exit
end

# Run command
exec command